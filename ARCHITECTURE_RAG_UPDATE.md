# RAG СИСТЕМА И АВТОМАТИЧЕСКОЕ ОБНОВЛЕНИЕ ДАННЫХ

Этот файл содержит новые разделы для добавления в ARCHITECTURE.md после раздела "Roadmap и будущие улучшения" и перед разделом "Безопасность и обработка персональных данных".

---

## RAG система и база знаний

### Общая концепция

Система использует **RAG (Retrieval-Augmented Generation)** для предоставления AI-агенту актуальной информации о квартирах, ценах и услугах. Все данные о недвижимости хранятся в векторной базе данных и автоматически индексируются для быстрого семантического поиска.

### Архитектура RAG системы

```
┌─────────────────────────────────────────────────────────────┐
│                   Источники данных                          │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   Сайт       │  │  1С CRM      │  │  Документы   │      │
│  │ minskmir.by  │  │  Каталог     │  │  (PDF/DOCX)  │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
│         │                  │                  │              │
└─────────┼──────────────────┼──────────────────┼──────────────┘
          │                  │                  │
          │ Автообновление   │ Синхронизация   │ Загрузка
          │ каждые 6 часов   │ real-time       │ вручную
          ▼                  ▼                  ▼
┌─────────────────────────────────────────────────────────────┐
│              Обработка и индексация данных                  │
│                                                             │
│  ┌────────────────────────────────────────────────────┐    │
│  │  1. Извлечение контента                            │    │
│  │     - Web scraping (Puppeteer/Cheerio)             │    │
│  │     - API запросы к 1С                             │    │
│  │     - Парсинг документов (PDF/DOCX)                │    │
│  └────────────┬───────────────────────────────────────┘    │
│               │                                             │
│               ▼                                             │
│  ┌────────────────────────────────────────────────────┐    │
│  │  2. Очистка и структурирование                     │    │
│  │     - Удаление HTML тегов                          │    │
│  │     - Нормализация текста                          │    │
│  │     - Извлечение метаданных                        │    │
│  └────────────┬───────────────────────────────────────┘    │
│               │                                             │
│               ▼                                             │
│  ┌────────────────────────────────────────────────────┐    │
│  │  3. Chunking (разбиение на фрагменты)              │    │
│  │     - Размер chunk: 512 токенов                    │    │
│  │     - Overlap: 50 токенов                          │    │
│  │     - Сохранение контекста                         │    │
│  └────────────┬───────────────────────────────────────┘    │
│               │                                             │
│               ▼                                             │
│  ┌────────────────────────────────────────────────────┐    │
│  │  4. Векторизация (Embeddings)                      │    │
│  │     Модель: text-embedding-3-large (OpenAI)        │    │
│  │     Размерность: 3072                              │    │
│  │     Язык: русский/английский                       │    │
│  └────────────┬───────────────────────────────────────┘    │
│               │                                             │
└───────────────┼─────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────┐
│              Векторная база данных                          │
│                                                             │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Pinecone / Supabase pgvector                      │    │
│  │                                                     │    │
│  │  Хранение:                                         │    │
│  │  - Векторные embeddings (3072 dim)                 │    │
│  │  - Оригинальный текст chunk                        │    │
│  │  - Метаданные:                                     │    │
│  │    * apartment_id                                  │    │
│  │    * address                                       │    │
│  │    * price                                         │    │
│  │    * area                                          │    │
│  │    * rooms                                         │    │
│  │    * floor                                         │    │
│  │    * source (website/crm/document)                 │    │
│  │    * last_updated                                  │    │
│  │                                                     │    │
│  │  Индексы:                                          │    │
│  │  - HNSW (Hierarchical Navigable Small World)       │    │
│  │  - Метрика: cosine similarity                      │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

[... продолжение с кодом и примерами ...]

---

## Автоматическое обновление данных

### Общий принцип

Система автоматически обновляет информацию о квартирах с сайта minskmir.by каждые **6 часов** с помощью web scraping и синхронизирует данные с 1С CRM в **real-time** через webhooks.

[... продолжение с диаграммами и кодом ...]

---

ДОБАВИТЬ ЭТИ РАЗДЕЛЫ В ARCHITECTURE.MD ПОСЛЕ РАЗДЕЛА "Roadmap и будущие улучшения"
